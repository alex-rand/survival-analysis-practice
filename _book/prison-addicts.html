<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Prison Addicts | Survival Analysis Practice Examples</title>
  <meta name="description" content="Fun examples to get better at survival analysis and hopefully put together a nice consistent workflow." />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Prison Addicts | Survival Analysis Practice Examples" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Fun examples to get better at survival analysis and hopefully put together a nice consistent workflow." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Prison Addicts | Survival Analysis Practice Examples" />
  
  <meta name="twitter:description" content="Fun examples to get better at survival analysis and hopefully put together a nice consistent workflow." />
  

<meta name="author" content="Alex Rand" />


<meta name="date" content="2022-05-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Survival Analysis Practice Examples</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> url: your book url like <span>https://bookdown.org/yihui/bookdown</span></a></li>
<li class="chapter" data-level="" data-path="prison-addicts.html"><a href="prison-addicts.html"><i class="fa fa-check"></i>Prison Addicts</a>
<ul>
<li class="chapter" data-level="1.1" data-path="prison-addicts.html"><a href="prison-addicts.html#basic-exploration"><i class="fa fa-check"></i><b>1.1</b> Basic Exploration</a></li>
<li class="chapter" data-level="1.2" data-path="prison-addicts.html"><a href="prison-addicts.html#how-does-time-to-event-vary-with-prison-status"><i class="fa fa-check"></i><b>1.2</b> How does time-to-event vary with prison status?</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Survival Analysis Practice Examples</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="prison-addicts" class="section level1 unnumbered hasAnchor">
<h1>Prison Addicts<a href="prison-addicts.html#prison-addicts" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="basic-exploration" class="section level2 hasAnchor" number="1.1">
<h2><span class="header-section-number">1.1</span> Basic Exploration<a href="prison-addicts.html#basic-exploration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I can’t seem to find any documentation explaining the experiment this data corresponds to. So let’s see if we can figure out the gist of it.</p>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:glimpse">Table 1.1: </span>
</caption>
<thead>
<tr>
<th style="text-align:left;">
skim_type
</th>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:left;">
numeric.hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
id
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
▇▇▆▇▇
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
clinic
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
▇▁▁▁▃
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
status
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
▅▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
days_survival
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
▇▅▆▃▁
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
prison
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
▇▁▁▁▇
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
dose
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
▁▇▇▃▁
</td>
</tr>
</tbody>
</table>
<p>So it looks like we’ve got the following:</p>
<ul>
<li><p><strong>ID</strong> is just your basic identifier;</p></li>
<li><p><strong>Clinic</strong> is a cluster variable. But there’s only two clusters, so not really enough to do a frailty model since that would only be two data points with which to estimate the sigma between clusters. Could be interesting to try out a stratified Cox though, or at least do those tests Singer and Willett mention to explore whether the clusters have different baselines;</p></li>
<li><p><strong>Status</strong> is the event column;</p></li>
<li><p><strong>Prison</strong> is ambiguous without documentation: are these people who are currently in prison, or people who have been in prison in the past? Either way, it will be a predictor to explore;</p></li>
<li><p><strong>Dose</strong> is I guess the treatment. It is continuous, which will be fun.</p></li>
</ul>
<p>I’m curious to explore the values within the Dose column a bit more:</p>
<p><img src="_main_files/figure-html/dose-values-1.png" width="816" /></p>
<p>Pretty varied, it seems.</p>
<p>Based on these</p>
<p>Ok. So now we can do some basic exploratory stuff with the whole sample. Singer and Willett recommend starting with the Kaplan Meier, Cumulative Hazard, and Kernel-Smoothed Hazard, so that’s what we’ll do.</p>
<p>We’ll use the canonical <code>survival</code> package, as well as the helpful <code>survminer</code> package for visualizations. The workflow starts with a weird first step: we need to create a ‘survival object’ of the type that the functions of the <strong>survival</strong> package can understand. This just takes the <code>time_to_event</code> and <code>status</code> columns of your dataset and turns them into a single column, where a number alone is a time-to-event, and a number with a plus sign beside it is time-to-censored. This is just the way they’ve decided to do things. Then we can use this ‘survival object’ to get the various curves we need.</p>
<p>So here we go:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="prison-addicts.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create survival object</span></span>
<span id="cb1-2"><a href="prison-addicts.html#cb1-2" aria-hidden="true" tabindex="-1"></a>surv_object <span class="ot">&lt;-</span> <span class="fu">Surv</span>(dat<span class="sc">$</span>days_survival, dat<span class="sc">$</span>status)</span>
<span id="cb1-3"><a href="prison-addicts.html#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="prison-addicts.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the Kaplan-Meier curve</span></span>
<span id="cb1-5"><a href="prison-addicts.html#cb1-5" aria-hidden="true" tabindex="-1"></a>km.full.sample <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_object <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> dat)</span>
<span id="cb1-6"><a href="prison-addicts.html#cb1-6" aria-hidden="true" tabindex="-1"></a>              </span>
<span id="cb1-7"><a href="prison-addicts.html#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Kaplan-Meier curve</span></span>
<span id="cb1-8"><a href="prison-addicts.html#cb1-8" aria-hidden="true" tabindex="-1"></a>km_full_sample_plot <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(</span>
<span id="cb1-9"><a href="prison-addicts.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit =</span> km.full.sample,</span>
<span id="cb1-10"><a href="prison-addicts.html#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-11"><a href="prison-addicts.html#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-12"><a href="prison-addicts.html#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">surv.median.line =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb1-13"><a href="prison-addicts.html#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb1-14"><a href="prison-addicts.html#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1-15"><a href="prison-addicts.html#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;cadetblue4&quot;</span>),</span>
<span id="cb1-16"><a href="prison-addicts.html#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Kaplan-Meier Estimated Survival Curve&quot;</span>,</span>
<span id="cb1-17"><a href="prison-addicts.html#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1-18"><a href="prison-addicts.html#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1-19"><a href="prison-addicts.html#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()</span>
<span id="cb1-20"><a href="prison-addicts.html#cb1-20" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb1-21"><a href="prison-addicts.html#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="prison-addicts.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Negative-Log cumulative hazard</span></span>
<span id="cb1-23"><a href="prison-addicts.html#cb1-23" aria-hidden="true" tabindex="-1"></a>cumhaz_full_sample_plot <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(</span>
<span id="cb1-24"><a href="prison-addicts.html#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit =</span> km.full.sample,</span>
<span id="cb1-25"><a href="prison-addicts.html#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-26"><a href="prison-addicts.html#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb1-27"><a href="prison-addicts.html#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1-28"><a href="prison-addicts.html#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;burlywood4&quot;</span>),</span>
<span id="cb1-29"><a href="prison-addicts.html#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="st">&quot;Negative Log Cumulative Hazard&quot;</span>,</span>
<span id="cb1-30"><a href="prison-addicts.html#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb1-31"><a href="prison-addicts.html#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb1-32"><a href="prison-addicts.html#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(),</span>
<span id="cb1-33"><a href="prison-addicts.html#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> <span class="st">&quot;cumhaz&quot;</span></span>
<span id="cb1-34"><a href="prison-addicts.html#cb1-34" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb1-35"><a href="prison-addicts.html#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="prison-addicts.html#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the kernel-smoothed hazard</span></span>
<span id="cb1-37"><a href="prison-addicts.html#cb1-37" aria-hidden="true" tabindex="-1"></a>kernel_smoothed_full_sample <span class="ot">&lt;-</span> <span class="fu">kernel_smoothed_hazard</span>(<span class="at">width=</span><span class="dv">60</span>, <span class="at">time=</span>dat<span class="sc">$</span>days_survival <span class="sc">*</span> <span class="dv">2</span>, <span class="at">survive=</span>dat<span class="sc">$</span>status <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-38"><a href="prison-addicts.html#cb1-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-39"><a href="prison-addicts.html#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb1-40"><a href="prison-addicts.html#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">&quot;aquamarine4&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1-41"><a href="prison-addicts.html#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1-42"><a href="prison-addicts.html#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Kernel-Smoothed Approximation of Hazard Function&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-43"><a href="prison-addicts.html#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Days After Completing amplify&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-44"><a href="prison-addicts.html#cb1-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Smoothed Hazard&quot;</span>) <span class="sc">+</span></span>
<span id="cb1-45"><a href="prison-addicts.html#cb1-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/full-sample-plots-1.png" width="816" /><img src="_main_files/figure-html/full-sample-plots-2.png" width="816" /><img src="_main_files/figure-html/full-sample-plots-3.png" width="816" /></p>
<p>Things are looking pretty consistent here. You have the typical thing of hazard being low at first but then increasing at psychologically-salient anniversaries, IE the two-month mark and the one-year mark. Things also seem to really take off at the 500 day mark as well.</p>
<p>Based on the data available, there are a few things I’m curious about:</p>
<ol style="list-style-type: decimal">
<li>How does time-to-event vary with prison status?</li>
<li>How does time-to-event vary with dosage amount?</li>
<li>Does the relationship between dosage amount and time-to-event vary in prison status? In other words, is there an interaction between dosage and prison status?</li>
<li>Is the proportional hazards assumption justified given the possibility of different baseline hazards across clinics?</li>
</ol>
<p>Let’s explore each of these questions.</p>
</div>
<div id="how-does-time-to-event-vary-with-prison-status" class="section level2 hasAnchor" number="1.2">
<h2><span class="header-section-number">1.2</span> How does time-to-event vary with prison status?<a href="prison-addicts.html#how-does-time-to-event-vary-with-prison-status" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For starters, we can plot the cumulative hazard curves for the two groups in isolation. If the cumulative hazard curves aren’t generally parallel on the log scale then when it comes time to model we should probably think about doing one of the things Singer and Willett suggest we do when we seem to have different baselines, between strata, IE either:</p>
<ol style="list-style-type: decimal">
<li>Do a stratified Cox regression;</li>
<li>Do time-varying effects.</li>
</ol>
<p>So let’s plot the stratified cumulative hazard curves:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="prison-addicts.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the new stratified Kaplan-Meier curve. </span></span>
<span id="cb2-2"><a href="prison-addicts.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We can reuse the same survival object from above.</span></span>
<span id="cb2-3"><a href="prison-addicts.html#cb2-3" aria-hidden="true" tabindex="-1"></a>km.prison.strat <span class="ot">&lt;-</span> <span class="fu">survfit</span>(surv_object <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">strata</span>(prison), <span class="at">data =</span> dat)</span>
<span id="cb2-4"><a href="prison-addicts.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="prison-addicts.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Kaplan-Meier curve</span></span>
<span id="cb2-6"><a href="prison-addicts.html#cb2-6" aria-hidden="true" tabindex="-1"></a>cumhaz_prison_strat <span class="ot">&lt;-</span> survminer<span class="sc">::</span><span class="fu">ggsurvplot</span>(</span>
<span id="cb2-7"><a href="prison-addicts.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">fit =</span> km.prison.strat,</span>
<span id="cb2-8"><a href="prison-addicts.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-9"><a href="prison-addicts.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">risk.table =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-10"><a href="prison-addicts.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">surv.median.line =</span> <span class="st">&quot;v&quot;</span>,</span>
<span id="cb2-11"><a href="prison-addicts.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb2-12"><a href="prison-addicts.html#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">legend =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb2-13"><a href="prison-addicts.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;cadetblue4&quot;</span>, <span class="st">&quot;burlywood4&quot;</span>),</span>
<span id="cb2-14"><a href="prison-addicts.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;&quot;</span>, </span>
<span id="cb2-15"><a href="prison-addicts.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb2-16"><a href="prison-addicts.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>()</span>
<span id="cb2-17"><a href="prison-addicts.html#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-18"><a href="prison-addicts.html#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="prison-addicts.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Call the plot</span></span>
<span id="cb2-20"><a href="prison-addicts.html#cb2-20" aria-hidden="true" tabindex="-1"></a>  cumhaz_prison_strat</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-1-1.png" width="816" /></p>
<p>It looks like being in prison <em>does</em> influence time to event, but not in a consistent way over time. But remember, what we’re worried about is whether <em>log</em> cumulative hazard. I’m not sure how to plot this yet. So actually, the fact that the difference grows over time could be an indication that the proportional hazard assumption does hold. I should figure out how to plot log cumulative hazard.</p>
<p>Another way of investigating the validity of the proportional hazards assumption for a particular predictor is to look at the Schoenfeld residuals of a cox regression with only prison as a predictor:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="prison-addicts.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a Cox regression</span></span>
<span id="cb3-2"><a href="prison-addicts.html#cb3-2" aria-hidden="true" tabindex="-1"></a>cox.prison.only <span class="ot">&lt;-</span> <span class="fu">coxph</span>(surv_object <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> prison, <span class="at">data =</span> dat)</span>
<span id="cb3-3"><a href="prison-addicts.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="prison-addicts.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a zph object, which takes a Cox model object and returnslots of nice diagnostic information specifically about the proportional hazards assumption of that Cox model</span></span>
<span id="cb3-5"><a href="prison-addicts.html#cb3-5" aria-hidden="true" tabindex="-1"></a>zph_object_cox_prison <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(cox.prison.only)</span>
<span id="cb3-6"><a href="prison-addicts.html#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="prison-addicts.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Schoenfeld residuals with Survminer</span></span>
<span id="cb3-8"><a href="prison-addicts.html#cb3-8" aria-hidden="true" tabindex="-1"></a>survminer<span class="sc">::</span><span class="fu">ggcoxzph</span>(zph_object_cox_prison)</span></code></pre></div>
<p><img src="_main_files/figure-html/schoenfeld-prison-1.png" width="816" /></p>
<p>This all suggests that the effect of people in prison might vary over time a bit, but the Schoenfeld p-value isn’t below .05, so I guess we are justified in not worrying about that. varies over time and is not amenable to the proportional hazards assumption.</p>
<p>If instead we had found that prison varies a bunch over time then we <em>could</em> do a stratified regression by prison. But Singer and Willett point out that if we do this then we won’t get a parameter estimate for the influence of prison, and that’s a parameter estimate it would be nice to have. So instead we can relax the proportional hazards assumption by interacting prison with time. We’re not gonna do this now because our Schoenfeld residuals say we don’t ahve to but the authors of the <strong>Survival</strong> package <a href="https://cran.r-project.org/web/packages/survival/vignettes/timedep.pdf">have written some nice documentation about precisely how to do this</a>.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/01-intro.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
